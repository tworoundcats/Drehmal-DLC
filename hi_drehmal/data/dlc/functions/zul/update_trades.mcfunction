execute unless entity @a[tag=clock,tag=!clocked] run scoreboard players reset #zul bool
execute if entity @a[tag=!clocked,tag=clock] if score #zul bool matches 1.. as @a[tag=!clocked,tag=clock] run function dlc:zul/clock
scoreboard players reset #zul bool
data remove entity @s Offers.Recipes
tag @s add trades

#trade 1 is any misc stuff
#trade 2 is any weapons
#trade 3 is any talismans and or trinkets
#we should prob have made a better system cause the more items in each category will dilute the pool but alas (if it's too much we can just say fuck the categories and make it true random though)
function dlc:zul/update_trades2
function dlc:zul/update_trades3
function dlc:zul/update_trades4


# starfall mote 1 > 4 scales
data modify entity @s Offers.Recipes insert 3 value {maxUses:2147483647,buy:{id:"dlc:starfall_mote",Count:1,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"A small amount of loose Starfall,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"shining with the light of the"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"night sky."}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Starfall Mote"}],"text":""}'}}},sell:{id: "emerald", Count: 4}}

# starfall mote 4 > 1 silver
data modify entity @s Offers.Recipes insert 4 value {maxUses:2147483647,buy:{id:"dlc:starfall_mote",Count:4,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"A small amount of loose Starfall,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"shining with the light of the"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"night sky."}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Starfall Mote"}],"text":""}'}}},sell:{id: "dlc:silver_ingot",tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"The merchants of Drehmal like a"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sack of scales as much as any"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"other, but for special equipment,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"silver is the currency of choice."}],"text":""}','{"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Silver Ingot"}],"text":""}'}}, Count: 1}}


# starfall mote 1 + 8 scales > 1 starfall mound
data modify entity @s Offers.Recipes insert 5 value {maxUses:2147483647,buy:{id:"dlc:starfall_mote",Count:1,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"A small amount of loose Starfall,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"shining with the light of the"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"night sky."}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Starfall Mote"}],"text":""}'}}},buyB:{id: "emerald",Count:8},sell:{id:"dlc:starfall_mound",Count:1,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"A piece of condensed Starfall,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"glimmering with the light and"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"promise of faraway stars."}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Starfall Mound"}],"text":""}'}}, Count: 1}}

# starfall mound 4 + 8 scale blocks > 1 starfall ingot
data modify entity @s Offers.Recipes insert 6 value {maxUses:2147483647,buy:{id:"dlc:starfall_mound",Count:4,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"A piece of condensed Starfall,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"glimmering with the light and"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"promise of faraway stars."}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Starfall Mound"}],"text":""}'}}},buyB:{id: "emerald_block",Count:8},sell:{id:"dlc:starfall_ingot",Count:1,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"A large amount of refined Starfall,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"basking in the light and majesty of"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"worlds beyond the Veil."}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Starfall Ingot"}],"text":""}'}}, Count: 1}}

# 2 celestial alloy > 1 starfall ingot
data modify entity @s Offers.Recipes insert 7 value {maxUses:2147483647,buy:{id:"netherite_ingot",Count:2},sell:{id:"dlc:starfall_ingot",Count:1,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"A large amount of refined Starfall,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"basking in the light and majesty of"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"worlds beyond the Veil."}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Starfall Ingot"}],"text":""}'}}, Count: 1}}

# syzygy upgrade questline item
execute unless score #gotSyz3 bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "minecraft:purpur_pillar", tag: {display: {Name: '{"extra":[{"italic":false,"underlined":true,"color":"dark_green","text":"Divine Amethyst"}],"text":""}', Lore: ['{"extra":[{"italic":true,"color":"dark_purple","text":"A block of infused amethyst, blessed"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"directly by the Aspect of Sky. A "}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"certain traveling Envoy would part"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"with something very valuable for the"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"chance to bring this to his master."}],"text":""}', '{"extra":[{"italic":false,"text":" "}],"text":""}', '{"extra":[{"italic":false,"color":"dark_green","text":"Quest Item"}],"text":""}', '{"text":""}']}}, Count: 1},sell:{id: "dlc:cat_toy", tag: {Damage: 0, display: {Name: '{"extra":[{"italic":false,"underlined":true,"color":"dark_green","text":"Strange Toy Wand"}],"text":""}', Lore: ['{"extra":[{"italic":true,"color":"dark_purple","text":"An elegantly carved stick with"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"strange feathers on the end. "}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"Irresistible to even the "}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"most intelligent cats."}],"text":""}', '{"extra":[{"italic":false,"text":" "}],"text":""}', '{"extra":[{"italic":false,"color":"dark_green","text":"Quest Item"}],"text":""}']}}, Count: 1}}

# zenith hint/key
execute if score #gotZen bool matches 1 unless score #gotZen3 bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "dlc:silver_ingot",Count:2,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"The merchants of Drehmal like a"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sack of scales as much as any"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"other, but for special equipment,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"silver is the currency of choice."}],"text":""}','{"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Silver Ingot"}],"text":""}'}}},sell:{id:"dlc:primal_focus_empty",tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"Only Avsohm knew the secret to refining rehntite"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"into workable material, and that secret died with"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"them. However, their facilities remain, the means"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"to process rehntite into wonders kept intact."}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":" "}],"text":""}','{"extra":[{"italic":true,"color":"dark_gray","text":"The Foundry\'s forges await new material."}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":" "}],"text":""}','{"extra":[{"italic":false,"color":"green","text":"Trinket"}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"green","text":"Rehntite Crystal"}],"text":""}'}}, Count: 1}}

# ascendance hint/key
execute if score #gotAsc bool matches 1 unless score #gotAsc3 bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "dlc:silver_ingot",Count:2,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"The merchants of Drehmal like a"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sack of scales as much as any"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"other, but for special equipment,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"silver is the currency of choice."}],"text":""}','{"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Silver Ingot"}],"text":""}'}}},sell:{id:"dlc:ruinous_tablet_empty",tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"Runes are engraved deeply onto its surface, intelligible"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"only to the now-extinct Tri-Moon Theocracy."}],"text":""}','{"extra":[{"text":" "}],"text":""}','{"extra":[{"italic":true,"color":"dark_gray","text":"What power would it unleash, if it were charged in a necrotic engine?"}],"text":""}','{"extra":[{"italic":true,"color":"dark_gray","text":" "}],"text":""}','{"extra":[{"italic":false,"color":"green","text":"Trinket"}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"green","text":"Inert Tablet"}],"text":""}'}}, Count: 1}}

# frenzy upgrade item (quest fail)
execute if score #gotFzy bool matches 1 if score #weller_happy bool matches 0 unless score #gotFzy3 bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "dlc:silver_ingot",Count:8,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"The merchants of Drehmal like a"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sack of scales as much as any"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"other, but for special equipment,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"silver is the currency of choice."}],"text":""}','{"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Silver Ingot"}],"text":""}'}}},buyB:{id:"dlc:mendarum_crystal",Count:2,tag:{display: {Name: '{"extra":[{"italic":false,"underlined":true,"color":"yellow","text":"Mendarum Crystal"}],"text":""}', Lore: ['{"extra":[{"italic":true,"color":"dark_purple","text":"Second in potentia only to rehntite,"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"mendarum crystals of this size and"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"quality are hard to come by since"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"Insohm\'s dissolution. Any Runic "}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"Blacksmith would kill to work with it."}],"text":""}']}}},sell:{id:"dlc:fateful_ore",tag:{Fateful:1b,display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"Crystallized emotion from Loruhn, grown by the anguish"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"of an imprisoned Aspect. Though unrefined, its hate could"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sharpen a suitable edge to an unparalleled degree."}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":" "}],"text":""}','{"extra":[{"italic":true,"color":"dark_gray","text":"Only the heat of Mt. Narukin could draw out the despair within."}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":" "}],"text":""}','{"extra":[{"italic":false,"color":"green","text":"Trinket"}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"green","text":"Painful Shard"}],"text":""}'}}, Count: 1}}

# frenzy hint (quest succeed)
execute if score #gotFzy bool matches 1 if score #weller_happy bool matches 1 unless score #gotFzy3 bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "minecraft:written_book", tag: {pages: ['{"text":"The people of Sahd have moved past the days of petty tribalism and bloodshed, due in large part to the revolting bloodshed that led to the creation of the frenzied blade. Sahdans of the Fourth Avihm know it as a cautionary tale, having largely passed into myth."}', '{"text":"Most of the island\'s remaining population is dedicated to preventing the weapon\'s reconstruction. One family of fishermen, with roots tracing back to the earliest days of the Second Avihm, takes this job particularly seriously. While they remain ever-insular, some"}', '{"text":"believe that this family is in possession of a rumored object of incredible power, perhaps yet another fragment of Irtheis\' masterwork unaccounted for. Of course, only those they trust deeply could ever know the truth of the matter."}'], RepairCost: 0, display: {Name: '{"extra":[{"italic":false,"underlined":true,"color":"white","text":"Secret of the Southeast"}],"text":""}', Lore: ['{"extra":[{"italic":true,"color":"dark_purple","text":"A note suggesting that part of a"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"profound power still remains"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"undiscovered in the far southeast."}],"text":""}']}, title: "", author: ""}, Count: 1}}


# calamity hint
execute if score #gotCal bool matches 1 unless score #gotCal3 bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "dlc:silver_ingot",Count:2,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"The merchants of Drehmal like a"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sack of scales as much as any"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"other, but for special equipment,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"silver is the currency of choice."}],"text":""}','{"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Silver Ingot"}],"text":""}'}}},sell:{id:"dlc:vertebrae",tag:{Calamitous:1b,display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"Ossein cares for the corpse of Femura with the"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"tenderness of a parent, obsessed with every part"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"of her skeleton."}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":" "}],"text":""}','{"extra":[{"italic":true,"color":"dark_gray","text":"Any bones lost or destroyed would attract his unending ire."}],"text":""}','{"extra":[{"italic":true,"color":"dark_gray","text":" "}],"text":""}','{"extra":[{"italic":false,"color":"green","text":"Trinket"}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"green","text":"Calamitous Digit"}],"text":""}'}}, Count: 1}}

# malevolentia upgrade hint book
execute if score #gotMal bool matches 1 unless score #gotMal3 bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "dlc:silver_ingot",Count:2,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"The merchants of Drehmal like a"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sack of scales as much as any"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"other, but for special equipment,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"silver is the currency of choice."}],"text":""}','{"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Silver Ingot"}],"text":""}'}}},sell:{id: "minecraft:written_book", tag:{RepairCost:0,author:"",display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"A lost page of a prominent diary."}],"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"white","text":"Tattered Note"}],"text":""}'},pages:['{"text":"Av3 18, 6th of Maelmaklah\\n\\nIt\'s all coming together, my friend. We cannot create, we can only take and repurpose. I had my suspicions, and now I have felt it with my own soul! The level of strength that we seek requires deity-scale consumption."}','{"text":"Before I claimed a sliver of that power, however, I heard Mael mention something. He told me that his blade, the fearsome Malevolentia, needed to be \\"fed\\". Made it seem as if his own innate power could... supercharge it, in a way that only he knows how to do."}','{"text":"Such thoughts do not concern me now. In time, perhaps I may wield that weapon, but the Work is far from complete. It does lead one to wonder, though... where did the others find their sources?"}'],resolved:1b,title:"Tattered Note"}, Count: 1}}

# avkohl upgrade hint book
execute if score #gotAvKohl bool matches 1 unless score #gotWings bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "dlc:silver_ingot",Count:2,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"The merchants of Drehmal like a"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sack of scales as much as any"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"other, but for special equipment,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"silver is the currency of choice."}],"text":""}','{"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Silver Ingot"}],"text":""}'}}},sell:{id: "minecraft:written_book", tag: {pages: ['{"text":"The feedback for the Avsohm\'Kohl prototypes I sent out just came back. Most of the complaints revolve around its lack of acceleration, how they want to soar through the air like the Virmari of old. However, I can\'t figure out a propulsion system that won\'t burn up"}', '{"text":"the wings or conflict with its arcana.\\n\\nVirmari... perhaps I should send a letter to the monks at Teiruun? Ask them how Virmari flew? Whatever they would reply with could only help - if it even just takes my mind off the problem for a while."}'], author: "", RepairCost: 0, display: {Name: '{"extra":[{"italic":false,"underlined":true,"color":"white","text":"Spectographer Koen\'s Notes"}],"text":""}', Lore: ['{"extra":[{"italic":true,"color":"dark_purple","text":"A potentially useful note, written"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"by a clever Avsohmic scientist."}],"text":""}']}, title: "SK Notes", resolved: 1b}, Count: 1}}

# proxigea/leviathan upgrade hint book
# this needs to be changed or just removed
#execute if score #gotprox bool matches 1 unless score #gotLev bool matches 1 run data modify entity @s Offers.Recipes append value {maxUses:1,buy:{id: "dlc:silver_ingot",Count:2,tag:{display:{Lore:['{"extra":[{"italic":true,"color":"dark_purple","text":"The merchants of Drehmal like a"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"sack of scales as much as any"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"other, but for special equipment,"}],"text":""}','{"extra":[{"italic":true,"color":"dark_purple","text":"silver is the currency of choice."}],"text":""}','{"text":""}'],Name:'{"extra":[{"italic":false,"underlined":true,"color":"aqua","text":"Silver Ingot"}],"text":""}'}}},sell:{id: "minecraft:written_book", tag: {pages: ['{"text":"...and rather than let Proxigea gather dust among his many treasures, Dahr saw it fit to serve as a reward for his challenge. The weapon was actually meant to be refurbished by Ytaj\'s resident Runic Blacksmith, but according to the smith, doing so would have required completing"}', '{"text":"the challenge themself. To this day, the challenge remains unbeaten, its grand prize unclaimed..."}'], author: "", display: {Name: '{"extra":[{"italic":false,"underlined":true,"color":"white","text":"A History of Lo\'Dahr, Volume I"}],"text":""}', Lore: ['{"extra":[{"italic":true,"color":"dark_purple","text":"Two torn-out pages of a Tehrmari"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"history book, pertaining to the Abyssal"}],"text":""}', '{"extra":[{"italic":true,"color":"dark_purple","text":"Elder."}],"text":""}']}, RepairCost: 0, title: ""}, Count: 1}}

data modify storage drehmal:entities zul set from entity @s Offers.Recipes
